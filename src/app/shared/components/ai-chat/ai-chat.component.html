<div class="ai-assistant-container">
    <div class="chat-bubble" (click)="toggleChat()">
        <i class="chat-icon">ðŸ¤–</i>
    </div>

    <div class="chat-window" *ngIf="isOpen">
        <div class="chat-header">
            <span>Assistente Financeiro</span>
            <button class="icon-btn" (click)="toggleChat()">âœ•</button>
        </div>

        <div class="chat-messages" #scrollContainer>
            <div *ngFor="let msg of messages" [ngClass]="['message', msg.role]">
                <div [innerText]="msg.content"></div>

                <!-- Transaction confirmation block -->
                <div class="transaction-confirm" *ngIf="msg.transaction">
                    <strong>Nova TransaÃ§Ã£o Detectada:</strong>
                    <div>DescriÃ§Ã£o: {{ msg.transaction.descricao }}</div>
                    <div>Valor: {{ msg.transaction.valor | currency:'BRL' }}</div>
                    <div>Tipo: {{ msg.transaction.tipo }}</div>
                    <div class="confirm-actions">
                        <button class="btn-confirm" (click)="confirmTransaction(msg.transaction)">Confirmar</button>
                        <button class="btn-cancel" (click)="cancelTransaction(msg)">Cancelar</button>
                    </div>
                </div>
            </div>
            <div class="message ai" *ngIf="isTyping">
                Processando...
            </div>
        </div>

        <div class="chat-input-area">
            <input type="file" #fileInput (change)="onFileSelected($event)" accept="image/*" style="display: none;">
            <button class="icon-btn" (click)="fileInput.click()" title="Enviar comprovante">
                <img src="/assets/img/adicionar.png" alt="Upload" />
            </button>
            <input type="text" class="chat-input" [(ngModel)]="userInput" (keyup.enter)="sendMessage()">
            <button class="icon-btn" (click)="sendMessage()">
                âž¤
            </button>
        </div>
    </div>
</div>